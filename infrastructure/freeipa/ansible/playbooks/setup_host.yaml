- name: Setup Hosts
  hosts: ipaserver 
  become: yes 
  gather_facts: yes
  vars:
  tasks: 
    - name: Set hostname 
      hostname: 
        name: 'ipa{{ "%02d" | format((lookup("ansible.utils.index_of", data=groups["masters"], test="search", value=ansible_host|trim) | int) +1) }}.{{dns_zone}}'
    - name: Disable IPv6
      sysctl:
        name: "{{ item }}"
        value: 1
        state: present
        reload: yes
      loop: 
        - net.ipv6.conf.all.disable_ipv6
        - net.ipv6.conf.default.disable_ipv6
        - net.ipv6.conf.eth0.disable_ipv6
        # - net.ipv6.conf.lo.disable_ipv6
    - name: Enable Lo IPv6
      sysctl:
        name: "net.ipv6.conf.lo.disable_ipv6"
        value: 0
        state: present
        reload: yes
