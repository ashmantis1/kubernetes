- name: Boostrap node for k8s cluster 1
  hosts: masters[1]
  become: true
  tasks:

    - name: Join cluster using generated command masters
      ansible.builtin.shell: "{{ hostvars[groups['bootstrap'][0]]['control_plane_join_command'] }}"
      when: "'bootstrap' not in group_names"
    
    - name: Template kube-vip to /etc/kubernetes/manifests folder
      ansible.builtin.template:
        src: ../templates/kube-vip.yaml.jinja2
        dest: /etc/kubernetes/manifests/kube-vip.yaml
    - name: Sleep
      ansible.builtin.wait_for:
        timeout: 100
- name: Boostrap node for k8s cluster 2
  hosts: masters[2]
  become: true
  tasks:

    - name: Join cluster using generated command masters
      ansible.builtin.shell: "{{ hostvars[groups['bootstrap'][0]]['control_plane_join_command'] }}"
      when: "'bootstrap' not in group_names"
    
    - name: Template kube-vip to /etc/kubernetes/manifests folder
      ansible.builtin.template:
        src: ../templates/kube-vip.yaml.jinja2
        dest: /etc/kubernetes/manifests/kube-vip.yaml
