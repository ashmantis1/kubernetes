- name: Set kube-vip version to install
  ansible.builtin.shell: curl -sL https://api.github.com/repos/kube-vip/kube-vip/releases | jq -r ".[0].name"
  register: kube_vip_version
- name: Generate kube-vip manifest
  ansible.builtin.shell: |
    ctr image pull ghcr.io/kube-vip/kube-vip:"{{kube_vip_version.stdout}}"; ctr run --rm --net-host ghcr.io/kube-vip/kube-vip:"{{kube_vip_version.stdout}}" vip /kube-vip manifest pod \
    --interface "{{interface}}" \
    --address "{{vip}}" \
    --controlplane \
    --services \
    --arp \
    --leaderElection | tee /etc/kubernetes/manifests/kube-vip.yaml

