- name: Boostrap node for k8s cluster 1
  hosts: masters
  become: true
  tasks:
  - name: Install vault
    include_role:
      name: ../roles/vault
  - name: template configuration for vault
    ansible.builtin.template:
      src: ../templates/config.hcl.jinja2
      dest: /etc/vault.d/vault.hcl
      owner: vault
      group: vault
  - name: enable and start vault service
    ansible.builtin.service:
      name: vault
      enabled: true
      state: started
  - name: init vault and print std out
    ansible.builtin.shell: "VAULT_ADDR=https://vault01.ashman.world:8200 vault operator init -key-shares=1 -key-threshold=1 --tls-skip-verify"
    register: vault_init
  - name: print output
    ansible.builtin.debug:
      msg: "{{ vault_init.stdout.split('\n') }}"