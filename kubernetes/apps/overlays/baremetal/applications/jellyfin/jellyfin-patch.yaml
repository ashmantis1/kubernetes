# yaml-language-server: $schema=https://kubernetes-schemas.devbu.io/helm.toolkit.fluxcd.io/helmrelease_v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: jellyfin
  namespace: jellyfin
spec:
  chart:
    spec:
      chart: jellyfin
  values: 
    image: 
      tag: latest
    persistentVolumes: 
      enabled: true
      storageClass: longhorn
      cacheSize: 10Gi
    extraVolumes: 
    - name: tv
      nfs:
        path: /volume1/TV
        server: 10.10.1.12
        readOnly: true
    - name: movies
      nfs: 
        path: /volume1/Movies
        server: 10.10.1.12
        readOnly: true
    volumeMounts: 
      - mountPath: /tv 
        name: tv 
      - mountPath: /movies 
        name: movies
    ingress: 
      enabled: true 
      className: nginx
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-prod
        # nginx.ingress.kubernetes.io/whitelist-source-range: 192.168.5.0/24,192.168.1.0/24,10.10.0.0/16 # allow on unpriv network
      hosts: 
        - host: jellyfin.ashman.world
          paths: 
            - path: /
              pathType: Prefix
      tls: 
        - secretName: jellyfin-tls
          hosts: 
            - jellyfin.ashman.world
    resources: 
      limits:
        gpu.intel.com/i915: 1
