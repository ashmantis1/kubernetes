# yaml-language-server: $schema=https://kubernetes-schemas.devbu.io/helm.toolkit.fluxcd.io/helmrelease_v2beta1.json
apiVersion: helm.toolkit.fluxcd.io/v2beta1
kind: HelmRelease
metadata:
  name: openshift-console
  namespace: openshift-console
spec:
  chart:
    spec:
      version: "0.3.11"
  values: 
    ingress: 
      enabled: true 
      className: nginx
      annotations:
        cert-manager.io/cluster-issuer: letsencrypt-prod
      hosts: 
        - host: console.k8s.ashman.world
          paths: 
            - path: / 
      tls: 
        - secretName: console-ingress-tls
          hosts: 
            - console.k8s.ashman.world
    extraEnv: 
        - name: BRIDGE_USER_AUTH_OIDC_CLIENT_SECRET
          valueFrom: 
            secretKeyRef: 
              name: oidc-secret
              key: KUBELOGIN_CLIENT_SECRET
    console: 
      dex: 
        host: "https://dex.ashman.world"
      baseUrl: https://console.k8s.ashman.world
      impersonateOpenShift: true
      oidc: 
        enabled: true
        issuerUrl: https://dex.k8s.ashman.world
        clientId: kubelogin
    volumes: 
      - name: logo 
        mountPath: /opt/bridge/static/assets/okd-logo.svg
        config: 
          configMap: 
            name: logo
        subPath: okd-logo.svg
